<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych-6/jspsych.js"></script>
    <script src="jspsych-6/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-6/plugins/jspsych-audio-keyboard-response.js"></script>
     <script src="jspsych-6/plugins/jspsych-audio-button-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-video-button-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-vsl-grid-scene.js"></script>
    <script src="js/tutorial.js"></script>
    <link rel="stylesheet" href="jspsych-6/css/jspsych.css"></link>
    <link rel="stylesheet" href="css_extra/image-button.css"></link>
  </hedd>
  <body></body>
  <script>

        var timeline = [];

        // shorthand for the "js/tutorial.js" additional structure
        var tut_learn = tut_learn_trial_info
        var tut_pract = tut_pract_trial_info 
        // learning & testing Block 1 (same  trial info)
        var test_learn_one = learn_trial_info_one
        var test_pract_one = learn_trial_info_one  
        //  Block 2 leaning and testing
        var test_learn_two = learn_trial_info_two
        var test_pract_two = learn_trial_info_two

        var test_nine_one = nine_trial_info;

        var test_beep = ['_audio/beep.mp3']

        // create list of all audio files for preloading
        var tut_pract_audio = [];
        for (var i=0; i<tut_learn.length; i++) {
            tut_pract_audio.push(tut_pract[i].target_audio);
            console.log('loaded tutorial practice audio')
        };

        var tut_learn_audio = [];
        for (var i=0; i<tut_learn.length; i++) {
            tut_learn_audio.push(tut_learn[i].target_audio);
            console.log('loaded tutorial learn audio')
        };

        var test_learn_one_audio = [];
        for (var i=0; i<test_learn_one.length; i++) {
            test_learn_one_audio.push(test_learn_one[i].target_audio);
            console.log('loaded learn one audio')
        };

        var test_pract_one_audio = [];
        for (var i=0; i<test_pract_one.length; i++) {
            test_pract_one_audio.push(test_pract_one[i].target_audio);
            console.log('loaded pract one audio')
        };

        var test_learn_two_audio = [];
        for (var i=0; i<test_learn_two.length; i++) {
            test_learn_two_audio.push(test_learn_two[i].target_audio);
            console.log('loaded learn two audio')
        };

        var test_pract_two_audio = [];
        for (var i=0; i<test_pract_two.length; i++) {
            test_pract_two_audio.push(test_pract_two[i].target_audio);
            console.log('loaded learn two audio')
        };

        var test_learn_beep_audio = [];
        for (var i=0; i<test_beep.length; i++) {
            test_learn_beep_audio.push(test_beep[i]);
            console.log('loaded learn beep audio')
        };

        var test_nine_one_audio = [];
        for (var i=0; i<test_pract_two.length; i++) {
            test_nine_one_audio.push(test_nine_one[i].target_audio);
            console.log('loaded nine choices audio')
        };

        var instructions = {
            type: 'instructions',
            pages: [
                '<p>In this task, you will see an image and hear a spoken word</p>'+
                "<br><br><p>In this phase, you don't have to respond, just watch and listen...</P>" +
                '<p>Click the "Next" button to start.</p>'
            ],
            show_clickable_nav: true,
            post_trial_gap: 1000
        };

        timeline.push(instructions);

        var fixation = {
            type: 'html-keyboard-response',
            stimulus: '<span style="font-size:40px;">+</span>',
            choices: jsPsych.NO_KEYS,
            trial_duration: 200,
            data: {
                trial_part: 'fixation', 
                task_part: jsPsych.timelineVariable('task_part')
            }
        };

        var single_target = {
            type: 'audio-keyboard-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.NO_KEYS,
            prompt: function() {
                return '<img src = "'+ jsPsych.timelineVariable('target_image', true) +'" >'},
            trial_ends_after_audio: false,
            trial_duration: 4000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'single_target',
                task_part: jsPsych.timelineVariable('task_part')
            }
        }; 

        var tut_learn_procedure = {
            timeline: [fixation, single_target],
            timeline_variables: tut_learn,
            randomize_order: true
        };
        
        //timeline.push(tut_learn_procedure)

        var start_tut_train = {
            type: 'html-button-response',
            stimulus: "<p>Great! Now there are some practice trials.</p>" +
            "<p>You will get feedback on your responses.</p><br><br>" +
            "<p>Click the 'Next' button to start.</p>",
            choices: ['Next'],
            response_ends_trial: true
        };
        

        // timeline.push(start_tut_train)
        
        
        var three_target = {
            type: 'audio-button-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.timelineVariable('choices'),
            button_html: [
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                ],
            prompt: "<p>select the right image...</p>",

            trial_ends_after_audio: false,
            trial_duration: 2000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'three_target',
                task_part: jsPsych.timelineVariable('task_part'),
                correct_response : jsPsych.timelineVariable('correct_response')
            },
            on_finish: function(data) {
                var acc = false;
                var used_button = data.button_pressed;
                var given_response = jsPsych.timelineVariable('choices')[used_button];
                
                // console.log(three_target.choices[data.button_pressed]);
                // console.log(given_response);
                
                if (data.correct_response == data.button_pressed) {
                    acc = true;
                }
                data.accuracy = acc;
                console.log(data.accuracy)
            }
        }; 
        
        var feedback = {
            type: 'html-keyboard-response',
            stimulus: function() {
                var feedback_text = '<span style="color:red;' +
                    'font-size:30px;">Incorrect.</span>'+
                    '<span style="color:black;'+ 
                    'font-size:30px;">The correct image was:</span>' +
                    '<br><br><img src = "'+ 
                    jsPsych.timelineVariable('target_image',true) +
                    '"><div>';
                var last_resp_acc = jsPsych.data.getLastTrialData().values()[0].accuracy;
                if (last_resp_acc == true) {
                    feedback_text = '<span style="color:green;font-size:30px;">Correct!</span>'
                }
                return feedback_text;
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000
        };
        
        var tut_pract_procedure = {
            timeline: [fixation, three_target, feedback],
            timeline_variables: tut_pract,
            randomize_order: true
        };
        
        // timeline.push(tut_pract_procedure);
        
        var start_real_train = {
            type: 'html-button-response',
            stimulus: "<p>Great! The real experiment starts now.</p>" +
            "<p>You only have to watch and listen in the next phase</p>" +
            "<p>Click the 'Next' button to start.</p>",
            choices: ['Next'],
            response_ends_trial: true
        };
        
        // timeline.push(start_real_train)
        
        var three_target_learn = {
            type: 'audio-button-response',
            stimulus: '_audio/beep.mp3',
            choices: jsPsych.timelineVariable('choices'),
            button_html: [
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                ],
            prompt: "<p>just look and listen</p>",
            trial_ends_after_audio: false,
            trial_duration: 1000,
            data: {   
                trial_part: 'three_target_learn',
                task_part: jsPsych.timelineVariable('task_part'),
            },
        }; 

        var single_target_learn = {
            type: 'audio-keyboard-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.NO_KEYS,
            prompt: function() {
                return '<img src = "'+ jsPsych.timelineVariable('target_image', true) +'" >'},
            trial_ends_after_audio: false,
            trial_duration: 1500,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'single_target_learn',
                task_part: jsPsych.timelineVariable('task_part')
            }
        }; 
        

        var test_learn_procedure_one = {
            timeline:[fixation, three_target_learn, single_target_learn],
            timeline_variables: test_learn_one,
            randomize_order: true,
        };
        
        // five runs for learning One
        // timeline.push(test_learn_procedure_one);
        // timeline.push(test_learn_procedure_one);
        // timeline.push(test_learn_procedure_one);
        // timeline.push(test_learn_procedure_one);
        // timeline.push(test_learn_procedure_one);



        var start_pract_one_screen = {
            type: 'html-button-response',
            stimulus: "Okay, now let's see how you like to PERFORM on block 1!", 
            choices: ['FUNKY'],
            response_ends_trial: true
        };

        // timeline.push(start_pract_one_screen);


        var three_target_test = {
            type: 'audio-button-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.timelineVariable('choices'),
            button_html: [
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                ],
            prompt: "<p>select the right image...within 10 secs </p>",

            trial_ends_after_response: true,
            trial_duration: 10000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'three_target_test',
                task_part: jsPsych.timelineVariable('task_part'),
                correct_response : jsPsych.timelineVariable('correct_response')
            },

            on_finish: function(data) {
                var acc = false;
                var used_button = data.button_pressed;
                var given_response = jsPsych.timelineVariable('choices')[used_button];
                
                
                if (data.correct_response == data.button_pressed) {
                    acc = true;
                }
                data.accuracy = acc;
                //console.log(data.accuracy)
            }
        }; 


        var test_pract_procedure_one = {
            timeline: [three_target_test, feedback],
            timeline_variables: test_pract_one,
            randomize_order: true
        };

        // four of these for testing/training
        //timeline.push(test_pract_procedure_one);
        // timeline.push(test_pract_procedure_one);
        // timeline.push(test_pract_procedure_one);
        // timeline.push(test_pract_procedure_one);

        // Block 2

        var start_learn_two_screen = {
            type: 'html-button-response',
            stimulus: "New passive learning block, you don't have to press or click after...", 
            choices: ['THIS'],
            response_ends_trial: true
        };

        // timeline.push(start_learn_two_screen);

        var test_learn_procedure_two = {
            timeline:[fixation, three_target_learn, single_target_learn],
            timeline_variables: test_learn_two,
            randomize_order: true,
        };   

        // five runs for learning Block 2
        //timeline.push(test_learn_procedure_two);
        // timeline.push(test_learn_procedure_two);
        // timeline.push(test_learn_procedure_two);
        // timeline.push(test_learn_procedure_two);
        // timeline.push(test_learn_procedure_two);

        var start_pract_two_screen = {
            type: 'html-button-response',
            stimulus: "Okay, now let's see how you like to PERFORM on block 2!", 
            choices: ['FUNKY FUNKY'],
            response_ends_trial: true
        };

        //timeline.push(start_pract_two_screen);

        var test_pract_procedure_two = {
            timeline:[fixation, three_target_test, feedback],
            timeline_variables: test_pract_two,
            randomize_order: true,
        };   

        // 4 runs for testing/practicing
        // timeline.push(test_pract_procedure_two);
        // timeline.push(test_pract_procedure_two);
        // timeline.push(test_pract_procedure_two);
        // timeline.push(test_pract_procedure_two);
        
        // block three, all the same, im not a xerox

        // Work on the neutral only video part, i'm not a copy-machine... three....

        // var test_video_trial = {
        //     type: 'video-button-response',
        //      sources: [
        //         '_video/ma1h.mp4',
        //         '_video/ma1h.ogg'
        //         ],
        //     choices: ['Happy','Sad','Angry','Peaceful'],
        //     autoplay: true,
        //     prompt: '<p>Which emotion the best descriptor of the main character\'s feelings?</p>'
        // };

        // timeline.push(test_video_trial)

        // var nine_target_learn = {
        //     type: 'audio-button-response',
        //     stimulus: jsPsych.timelineVariable('target_audio'),
        //     choices: jsPsych.timelineVariable('choices'),
        //     button_html: [
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
        //         ],
        //     prompt: "<p>i show you all...</p>",
        //     trial_ends_after_audio: false,
        //     trial_duration: 4000,
        //     data: {
        //         target_audio: jsPsych.timelineVariable('target_audio'),
        //         target_image: jsPsych.timelineVariable('target_image'),
        //         condition: jsPsych.timelineVariable('condition'),
        //         trial_part: 'nine_target_test',
        //         task_part: jsPsych.timelineVariable('task_part'),
        //         correct_response : jsPsych.timelineVariable('correct_response')
        //     },

        var pattern = [ 
            ["_image/_a1i.png", "_image/_a2i.png", "_image/_a3i.png"],
            ["_image/_b1i.png", "_image/_b2i.png","_image/_a3i.png"],
            ["_image/_c1i.png", "_image/_c2i.png","_image/_c3i.png"]
        ];

        var image_size = 100; // pixels

        var grid_stimulus = jsPsych.plugins['vsl-grid-scene'].generate_stimulus(pattern, image_size);

        // var bhtml = '<div class="wrapper">'
        //     bhtml += '<div><button><img src=_image/%choice%i.png></button></div>'
        //     bhtml += '<div><button><img src=_image/%choice%i.png></button></div>'
        //     bhtml += '<div><button><img src=_image/%choice%i.png></button></div>'
        //     bhtml += '</div>';

        var bhtml = '<div class="wrapper">'
            bhtml += '<div><div><button><img src=_image/%choice%i.png></button></div></div>'
            bhtml += '</div>';

        // var bhtml = '<div class="wrapper">'
        //     bhtml += '<div><button><img src=_image/%choice%i.png></button></div>'
        //     bhtml += '</div>';   

        var nine_target_learn = {
            type: 'audio-button-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.timelineVariable('choices'),
            // button_html:
            //     '<button class="img-btn-small"><img src=_image/%choice%i.png></button>',
            button_html: bhtml,
            prompt: "<p>i show you some...</p>",
            trial_ends_after_audio: false,
            trial_duration: 4000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'nine_target_test',
                task_part: jsPsych.timelineVariable('task_part'),
                correct_response : jsPsych.timelineVariable('correct_response')
            },

            // on_start: function() {
            //     var buttons = document.getElementsByClassName('img-btn-small');
            //     console.log(buttons)
            //     buttons.height = '20px';
            //     buttons.width = '20px';
            //     console.log("small buttons?...");
            // },

            on_finish: function(data) {
                var acc = false;
                var used_button = data.button_pressed;
                var given_response = jsPsych.timelineVariable('choices')[used_button];
                
                if (data.correct_response == data.button_pressed) {
                    acc = true;
                }
                data.accuracy = acc;
                console.log(data.accuracy)
            }
        }; 


// pass into other plugins that accept HTML stimuli as input, such as jspsych-html-keyboard-response.

        // var button_downsize = function(){
        //     var buts = document.getElementById('img-btn');
        //     buts.style.height = '40px';
        //     console.log("i'm a dork...");
        // };

        var test_nine_procedure_one = {
            timeline:[nine_target_learn],
            timeline_variables: test_nine_one,
            randomize_order: true,
        };

        timeline.push(test_nine_procedure_one);



        var end_screen = {
            type: 'html-keyboard-response',
            stimulus: "Thanks, you're done. Press spacebar to see data", 
            choices: ['space']
        };
        
        timeline.push(end_screen);

        jsPsych.init({
            timeline: timeline,
            preload_audio: [
                tut_learn_audio, 
                tut_pract_audio,
                test_learn_one_audio, 
                test_pract_one_audio,
                test_learn_two_audio, 
                test_pract_two_audio,
                test_learn_beep_audio,
                test_nine_one_audio,
                ],
            show_preload_progress_bar: false,
            use_webaudio: false,
            on_finish: function() {
                jsPsych.data.displayData();
            }
        })

    </script>
</html>