<!DOCTYPE html>
<html>
  <head>
    <script src="jspsych-6/jspsych.js"></script>
    <script src="jspsych-6/plugins/jspsych-instructions.js"></script>
    <script src="jspsych-6/plugins/jspsych-audio-keyboard-response.js"></script>
     <script src="jspsych-6/plugins/jspsych-audio-button-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-html-button-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="js/tutorial.js"></script>
    <link rel="stylesheet" href="jspsych-6/css/jspsych.css"></link>
    <link rel="stylesheet" href="css_extra/image-button.css"></link>
  </hedd>
  <body></body>
  <script>

        var timeline = [];

        // shorthand for the js var called tu
        var tut_learn = tut_learn_trial_info
        var tut_pract = tut_pract_trial_info 
        var test_learn = learn_trial_info_one
        var test_pract = learn_trial_info_one        
        var test_beep = ['_audio/beep.mp3']
        
        // var sofar = tut_learn.length + tut_pract.length + test_learn

        // create list of all audio files for preloading
        // var all_audio = [];
        // for (var i=0; i<practice_trial_info.length; i++) {
        //     all_audio.push(practice_trial_info[i].target_audio);

        // create list of all audio files for preloading
        var tut_pract_audio = [];
        for (var i=0; i<tut_learn.length; i++) {
            tut_pract_audio.push(tut_pract[i].target_audio);
            console.log('loaded tutorial practice audio')
        };

        var tut_learn_audio = [];
        for (var i=0; i<tut_learn.length; i++) {
            tut_learn_audio.push(tut_learn[i].target_audio);
            console.log('loaded tutorial learn audio')
        };

        var test_learn_audio = [];
        for (var i=0; i<test_learn.length; i++) {
            test_learn_audio.push(test_learn[i].target_audio);
            console.log('loaded learn audio')
        };

        var test_learn_beep_audio = [];
        for (var i=0; i<test_beep.length; i++) {
            test_learn_beep_audio.push(test_beep[i]);
            console.log('loaded learn beep audio')
        };

        // var all_audio = [];
        // for (var i=0; i<tut_learn.length+; i++) {
        //     all_audio.push(tut_learn[i].target_audio);
        //     console.log('loaded tutorial audio')
        // }


        var instructions = {
            type: 'instructions',
            pages: [
                '<p>In this task, you will see an image and hear a spoken word</p>'+
                "<br><br><p>In this phase, you don't have to respond, just watch and listen...</P>" +
                '<p>Click the "Next" button to start.</p>'
            ],
            show_clickable_nav: true,
            post_trial_gap: 1000
        };

        timeline.push(instructions);

        var fixation = {
            type: 'html-keyboard-response',
            stimulus: '<span style="font-size:40px;">+</span>',
            choices: jsPsych.NO_KEYS,
            trial_duration: 200,
            data: {
                trial_part: 'fixation', 
                task_part: jsPsych.timelineVariable('task_part')
            }
        };

        var single_target = {
            type: 'audio-keyboard-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.NO_KEYS,
            prompt: function() {
                return '<img src = "'+ jsPsych.timelineVariable('target_image', true) +'" >'},
            trial_ends_after_audio: false,
            trial_duration: 2000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'single_target',
                task_part: jsPsych.timelineVariable('task_part')
            }
        }; 

        var tut_learn_procedure = {
            timeline: [fixation, single_target],
            timeline_variables: tut_learn,
            randomize_order: true
        };
        
         timeline.push(tut_learn_procedure)

        var start_tut_train = {
            type: 'html-button-response',
            stimulus: "<p>Great! Now there are some practice trials.</p>" +
            "<p>You will get feedback on your responses.</p><br><br>" +
            "<p>Click the 'Next' button to start.</p>",
            choices: ['Next'],
            response_ends_trial: true
        };
        

        timeline.push(start_tut_train)
        
        
        var three_target = {
            type: 'audio-button-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.timelineVariable('choices'),
            button_html: [
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                ],
            prompt: "<p>select the right image...</p>",

            trial_ends_after_audio: false,
            trial_duration: 2000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'three_target',
                task_part: jsPsych.timelineVariable('task_part'),
                correct_response : jsPsych.timelineVariable('correct_response')
            },
            on_finish: function(data) {
                var acc = false;
                var used_button = data.button_pressed;
                var given_response = jsPsych.timelineVariable('choices')[used_button];
                
                // console.log(three_target.choices[data.button_pressed]);
                // console.log(given_response);
                
                if (data.correct_response == data.button_pressed) {
                    acc = true;
                }
                data.accuracy = acc;
                console.log(data.accuracy)
            }
        }; 
        
        var feedback = {
            type: 'html-keyboard-response',
            stimulus: function() {
                var feedback_text = '<span style="color:red;' +
                    'font-size:30px;">Incorrect.</span>'+
                    '<span style="color:black;'+ 
                    'font-size:30px;">The correct image was:</span>' +
                    '<br><br><img src = "'+ 
                    jsPsych.timelineVariable('target_image',true) +
                    '"><div>';
                var last_resp_acc = jsPsych.data.getLastTrialData().values()[0].accuracy;
                if (last_resp_acc == true) {
                    feedback_text = '<span style="color:green;font-size:30px;">Correct!</span>'
                }
                return feedback_text;
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000
        };
        
        var tut_pract_procedure = {
            timeline: [fixation, three_target, feedback],
            timeline_variables: tut_pract,
            randomize_order: true
        };
        
        timeline.push(tut_pract_procedure);
        
        var start_real_train = {
            type: 'html-button-response',
            stimulus: "<p>Great! The real experiment starts now.</p>" +
            "<p>You only have to watch and listen in the next phase</p>" +
            "<p>Click the 'Next' button to start.</p>",
            choices: ['Next'],
            response_ends_trial: true
        };
        
        timeline.push(start_real_train)
        
        var three_target_learn = {
            type: 'audio-button-response',
            stimulus: '_audio/beep.mp3',
            choices: jsPsych.timelineVariable('choices'),
            button_html: [
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                ],
            prompt: "<p>just look and listen</p>",
            trial_ends_after_audio: false,
            trial_duration: 1000,
            data: {   
                trial_part: 'three_target_learn',
                task_part: jsPsych.timelineVariable('task_part'),
            },
        }; 

        var single_target_learn = {
            type: 'audio-keyboard-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.NO_KEYS,
            prompt: function() {
                return '<img src = "'+ jsPsych.timelineVariable('target_image', true) +'" >'},
            trial_ends_after_audio: false,
            trial_duration: 1500,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'single_target_learn',
                task_part: jsPsych.timelineVariable('task_part')
            }
        }; 
        


        //var shuffled_learn = jsPsych.randomiser.repeat(learn_block_one_list, 5);

        // this might be better
        var factors = {
            stimulus: ['_image/_a1i.png', '_image/_b2i.png','_image/_c3i.png'],
            audio: ['_audio/_a1s.wav', '_audio/_b2s.wav','_audio/_c2s.wav'],
            type:['audio-button-response','audio-button-response']
        }

        // var full_design = jsPsych.randomization.factorial(factors, 1);
        // console.log(full_design)

        var learn_procedure = {
            timeline:[fixation, three_target_learn, single_target_learn],
            timeline_variables: test_learn,
            randomize_order: true,
        };
        

        timeline.push(learn_procedure);
        timeline.push(learn_procedure);
        timeline.push(learn_procedure);



        var three_target_test = {
            type: 'audio-button-response',
            stimulus: jsPsych.timelineVariable('target_audio'),
            choices: jsPsych.timelineVariable('choices'),
            button_html: [
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                '<button class="img-btn"><img src=_image/%choice%i.png></button>',
                ],
            prompt: "<p>select the right image...within 10 secs </p>",

            trial_ends_after_response: true,
            trial_duration: 10000,
            data: {
                target_audio: jsPsych.timelineVariable('target_audio'),
                target_image: jsPsych.timelineVariable('target_image'),
                condition: jsPsych.timelineVariable('condition'),
                trial_part: 'three_target_test',
                task_part: jsPsych.timelineVariable('task_part'),
                correct_response : jsPsych.timelineVariable('correct_response')
            },

            on_finish: function(data) {
                var acc = false;
                var used_button = data.button_pressed;
                var given_response = jsPsych.timelineVariable('choices')[used_button];
                
                // console.log(three_target.choices[data.button_pressed]);
                // console.log(given_response);
                
                if (data.correct_response == data.button_pressed) {
                    acc = true;
                }
                data.accuracy = acc;
                console.log(data.accuracy)
            }
        }; 


        var test_pract_procedure = {
            timeline: [three_target_test, feedback],
            timeline_variables: test_pract,
            randomize_order: true
        };

        timeline.push(test_pract_procedure);
        timeline.push(test_pract_procedure);
        timeline.push(test_pract_procedure);

        var end_screen = {
            type: 'html-keyboard-response',
            stimulus: "Thanks, you're done with the task!", 
            choices: ['space']
        };
        
        timeline.push(end_screen);

        jsPsych.init({
            timeline: timeline,
            preload_audio: [tut_learn_audio, tut_pract_audio,test_learn_audio, test_learn_beep_audio],
            show_preload_progress_bar: true,
            use_webaudio: false,
            on_finish: function() {
                jsPsych.data.displayData();
            }
        })

    </script>
</html>